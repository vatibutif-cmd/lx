# 服务端代码同步与更新指南

本文档旨在指导您在修改代码后，如何正确同步更新到运行中的服务器。

## 1. 前端代码更新 (`src/` 目录)

当您修改了 `src/pages/BigScreen.jsx`、CSS 样式或其他 React 组件时，需要重新编译前端资源。

**操作步骤：**

1.  **执行构建命令**：
    在终端中运行以下命令（确保在 `ui-restoration` 目录下）：
    ```bash
    npm run build
    ```
    *说明：该命令会调用 Vite 将源代码编译并输出到 `dist/` 目录。服务器实际上是托管 `dist/` 目录下的静态文件。*

2.  **验证更新**：
    *   **通常无需重启服务器**。
    *   等待构建完成后（显示 `built in ...`），直接刷新浏览器中的大屏页面即可看到最新效果。

## 2. 后端代码更新 (`server/` 目录)

当您修改了 `server/index.js` 中的业务逻辑（例如：修改了进度增长速度、Socket.io 事件处理、庆祝逻辑等）时，必须重启服务器。

**操作步骤：**

1.  **停止当前服务**：
    *   找到正在运行 `npm run server` 的终端窗口。
    *   按键盘快捷键 `Ctrl + C` 终止进程。

2.  **重启服务**：
    *   再次输入并运行：
        ```bash
        npm run server
        ```

3.  **客户端刷新**：
    *   服务器重启会导致 Socket 连接断开。虽然前端会自动重连，但为了确保状态（如当前的进度值）显示正确，建议**刷新浏览器页面**。

## 3. 完整发布流程 (推荐)

如果您同时修改了前端和后端，或者不确定更改是否生效，建议按照以下标准流程操作：

1.  **停止服务器**：在服务端终端按 `Ctrl + C`。
2.  **全量构建**：运行 `npm run build` 确保前端是最新的。
3.  **启动服务器**：运行 `npm run server`。
4.  **检查输出**：观察控制台显示的访问地址（如 `http://192.168.x.x:3001`）。
5.  **验证页面**：在浏览器中打开地址，确认功能正常。

## 4. Git 同步部署流程 (推荐生产环境使用)

如果您使用 Git 进行版本控制和部署，请遵循以下流程。

### 开发环境 (本地)

1.  **提交更改**：
    确保所有修改都已提交到 Git 仓库。
    ```bash
    git add .
    git commit -m "更新说明: 删除了冗余文字，优化了动画效果"
    ```

2.  **推送到远程**：
    ```bash
    git push origin master
    ```

### 生产环境 (服务器端)

1.  **拉取最新代码**：
    登录到服务器，进入项目目录，拉取最新代码。
    ```bash
    cd /path/to/ui-restoration
    git pull origin master
    ```

2.  **安装依赖 (如果有新增依赖)**：
    ```bash
    npm install
    ```

3.  **重新构建前端**：
    ```bash
    npm run build
    ```

4.  **重启服务**：
    使用 PM2 (推荐) 或直接重启 Node 进程。
    
    *如果使用 PM2:*
    ```bash
    pm2 restart ui-restoration
    ```
    
    *如果使用 npm run server:*
    先按 `Ctrl + C` 停止当前进程，然后运行：
    ```bash
    npm run server
    ```

## 常见问题排查

*   **修改后没变化？**
    *   请检查是否执行了 `npm run build`。只保存文件是不够的，必须编译。
    *   请尝试清除浏览器缓存或使用无痕模式访问。

*   **端口被占用 (EADDRINUSE)？**
    *   说明上一个服务进程没有彻底关闭。
    *   请确保终端中没有正在运行的 `node server/index.js` 进程。
    *   如果问题持续，可以尝试关闭所有终端窗口后重试。
